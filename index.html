<!DOCTYPE html>
<html>
<head>
  <title>DUELSHIFT</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      overflow: hidden;
      background: #111;
    }

    /* FULLSCREEN MENU OVERLAY */
    #menuOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #111;
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
    }
    #menuOverlay input, #menuOverlay button {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
    }
    #menuButtons {
      display: none;
      margin-top: 20px;
      flex-direction: row;
      gap: 20px;
    }

    /* HUD */
    #weaponDisplay, #ammoDisplay, #playerInfo, #shop {
      z-index: 10;
      position: absolute;
    }
    #weaponDisplay {
      bottom: 10px;
      right: 10px;
      width: 50px;
      height: 20px;
      background: gray;
      border: 2px solid #555;
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: white;
      display: none;
    }
    #ammoDisplay {
      bottom: 50px;
      right: 10px;
      color: white;
      background: #222;
      padding: 5px 10px;
      border-radius: 5px;
      font-family: monospace;
      display: none;
    }
    #playerInfo { top: 10px; right: 10px; color: white; }

    /* SHOP */
    #shop {
      right: 10px;
      top: 70px;
      width: 200px;
      height: 300px;
      background: #333;
      color: white;
      overflow-y: auto;
      padding: 10px;
      display: none;
    }

    /* CANVAS */
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #111;
      z-index: 1;
    }

    /* MUZZLE FLASH */
    .flash {
      position: absolute;
      width: 50px;
      height: 50px;
      background: yellow;
      border-radius: 50%;
      right: 60px;
      bottom: 30px;
      opacity: 0.8;
    }

  </style>
</head>
<body>

<!-- FULLSCREEN MENU -->
<div id="menuOverlay">
  <h1>DUELSHIFT</h1>
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <button id="loginBtn">Login</button>

  <div id="menuButtons">
    <button id="playBtn">Play</button>
    <button id="shopBtn">Shop</button>
    <button id="ranksBtn">Ranks</button>
  </div>
</div>

<!-- HUD -->
<div id="playerInfo"></div>
<div id="weaponDisplay">Pistol</div>
<div id="ammoDisplay">Ammo: 6 / 6</div>
<div id="shop">
  <h3>Shop</h3>
  <div id="shopItems"></div>
  <input type="text" id="newItemInput" placeholder="Add new item">
  <button id="addItemBtn">Add Item</button>
</div>

<!-- GAME CANVAS -->
<canvas id="game"></canvas>

<script src="https://cdn.jsdelivr.net/npm/three@0.155/build/three.min.js"></script>
<script>
// ---------- MENU & LOGIN ----------
const menuOverlay = document.getElementById('menuOverlay');
const loginBtn = document.getElementById('loginBtn');
const menuButtons = document.getElementById('menuButtons');
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');
const playerInfo = document.getElementById('playerInfo');
const playBtn = document.getElementById('playBtn');

let playerRank = 'Player';

loginBtn.onclick = () => {
  const user = usernameInput.value;
  const pass = passwordInput.value;

  if(user === 'SkyPer' && pass === '1618917'){
    playerRank = 'Owner';
    playerInfo.innerHTML = `<span style="color:red">[Owner]</span> ${user}`;
  } else if(user !== '' && pass !== ''){
    playerRank = 'Player';
    playerInfo.innerHTML = `<span style="color:gray">[Player]</span> ${user}`;
  } else {
    alert('Enter username and password');
    return;
  }

  usernameInput.style.display = 'none';
  passwordInput.style.display = 'none';
  loginBtn.style.display = 'none';
  menuButtons.style.display = 'flex';
};

// ---------- SHOP ----------
const shopBtn = document.getElementById('shopBtn');
const shopDiv = document.getElementById('shop');
const shopItemsDiv = document.getElementById('shopItems');
const addItemBtn = document.getElementById('addItemBtn');
const newItemInput = document.getElementById('newItemInput');
let shopItems = ['Pistol'];

function updateShop(){
  shopItemsDiv.innerHTML = '';
  shopItems.forEach(item=>{
    const div = document.createElement('div');
    div.textContent = item;
    shopItemsDiv.appendChild(div);
  });
  addItemBtn.style.display = (playerRank === 'Owner') ? 'block' : 'none';
  newItemInput.style.display = (playerRank === 'Owner') ? 'block' : 'none';
}

shopBtn.onclick = ()=>{
  shopDiv.style.display = shopDiv.style.display === 'none' ? 'block' : 'none';
  updateShop();
};

addItemBtn.onclick = ()=>{
  const newItem = newItemInput.value;
  if(newItem){
    shopItems.push(newItem);
    newItemInput.value = '';
    updateShop();
  }
};

// ---------- GAME & PLAYER ----------
const canvas = document.getElementById('game');
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight,0.1,1000);
const renderer = new THREE.WebGLRenderer({canvas});
renderer.setSize(window.innerWidth, window.innerHeight);
camera.position.set(0,3,5);

// LIGHT
const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(5,10,7);
scene.add(light);

// PLAYER CYLINDER
const geometry = new THREE.CylinderGeometry(0.5,0.5,2,32);
const material = new THREE.MeshStandardMaterial({color:0xffffff});
const player = new THREE.Mesh(geometry,material);
scene.add(player);
player.position.y = 1;

// RESIZE
window.addEventListener('resize', ()=>{
  renderer.setSize(window.innerWidth, window.innerHeight);
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
});

// MOUSE ROTATION
let isMouseDown=false, previousX;
document.addEventListener('mousedown', (e)=>{isMouseDown=true; previousX=e.clientX;});
document.addEventListener('mouseup', ()=>{isMouseDown=false;});
document.addEventListener('mousemove', (e)=>{
  if(isMouseDown){
    const deltaX = e.clientX-previousX;
    player.rotation.y += deltaX*0.01;
    previousX=e.clientX;
  }
});

// MOVEMENT
const keys = {};
document.addEventListener('keydown', e=>{keys[e.key]=true;});
document.addEventListener('keyup', e=>{keys[e.key]=false;});

// AMMO & SHOOTING
let ammo=6, maxAmmo=6, reloading=false;
const ammoDisplay = document.getElementById('ammoDisplay');

function shootGun(){
  if(reloading) return;
  if(ammo>0){
    ammo--;
    ammoDisplay.textContent=`Ammo: ${ammo} / ${maxAmmo}`;

    // MUZZLE FLASH
    const flash=document.createElement('div');
    flash.classList.add('flash');
    document.body.appendChild(flash);
    setTimeout(()=>document.body.removeChild(flash),100);
  } else reloadGun();
}

function reloadGun(){
  reloading=true;
  ammoDisplay.textContent='Reloading...';
  let rotation=0;
  const reloadInterval = setInterval(()=>{
    rotation+=0.1;
    player.rotation.z=rotation;
  },50);
  setTimeout(()=>{
    clearInterval(reloadInterval);
    player.rotation.z=0;
    ammo=maxAmmo;
    ammoDisplay.textContent=`Ammo: ${ammo} / ${maxAmmo}`;
    reloading=false;
  },1500);
}

// PLAY BUTTON
playBtn.onclick = ()=>{
  menuOverlay.style.display='none';
  document.getElementById('weaponDisplay').style.display='flex';
  document.getElementById('ammoDisplay').style.display='flex';
};

// GAME LOOP
function animate(){
  requestAnimationFrame(animate);

  if(keys['w']) player.position.z-=0.1;
  if(keys['s']) player.position.z+=0.1;
  if(keys['a']) player.position.x-=0.1;
  if(keys['d']) player.position.x+=0.1;

  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
